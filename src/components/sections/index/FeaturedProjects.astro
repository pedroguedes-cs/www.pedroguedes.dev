---
import { getCollection, type CollectionEntry } from "astro:content";
import { ChevronLeft, ChevronRight } from "@lucide/astro";

import Section from "../../layout/Section.astro";
import ProjectCard from "../../ui/ProjectCard.astro";
import Button from "../../ui/Button.astro";

const projects: CollectionEntry<"projects">[] = await getCollection("projects");
const featuredProjects = projects.filter((p) => p.data.featured);
---

<Section id="projects-preview" title="FEATURED PROJECTS" variant="base">
  <div class="projects-preview-layout">
    <div class="projects-preview-swiper-container">
      <div class="swiper-button-prev icon-wrapper">
        <ChevronLeft class="icon icon-lg icon-primary" />
      </div>
      <div class="swiper swiper-projects-preview">
        <div class="swiper-wrapper">
          {
            featuredProjects.map((project) => (
              <div class="swiper-slide">
                <ProjectCard project={project} projectsPreview />
              </div>
            ))
          }
        </div>
        <div class="swiper-pagination"></div>
      </div>
      <div class="swiper-button-next icon-wrapper">
        <ChevronRight class="icon icon-lg icon-primary" />
      </div>
    </div>

    <Button href="/projects" label="All Projects" variant="primary" />
  </div>
</Section>

<style>
  .projects-preview-layout {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-lg);
  }
  .projects-preview-swiper-container {
    position: relative;
    width: 100%;
    display: flex;
    align-items: center;
    gap: var(--space-sm);
  }
  .swiper-projects-preview {
    flex: 1;
    min-width: 0;
    overflow: hidden;
    padding-bottom: var(--space-lg);
  }
  .swiper-wrapper {
    width: 100%;
    align-items: stretch;
  }
  .swiper-slide {
    height: auto;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .swiper-button-next,
  .swiper-button-prev {
    display: none;
  }
  .icon-wrapper {
    background-color: var(--color-base);
  }
  .swiper-pagination {
    bottom: 0;
  }
  .swiper-pagination-bullet {
    background-color: var(--color-text);
  }
  @media (min-width: 1024px) {
    .swiper-button-next,
    .swiper-button-prev {
      position: initial;
      display: block;
    }
  }
</style>

<script>
  import Swiper from "swiper";
  import { Navigation, Pagination, Autoplay } from "swiper/modules";

  const swiper = new Swiper(".swiper-projects-preview", {
    modules: [Navigation, Pagination, Autoplay],

    slidesPerView: 1,
    spaceBetween: 20,
    loop: true,

    autoplay: {
      delay: 6000,
      disableOnInteraction: false,
    },

    navigation: {
      nextEl: ".swiper-button-next",
      prevEl: ".swiper-button-prev",
    },

    pagination: {
      el: ".swiper-projects-preview .swiper-pagination",
      type: "bullets",
      clickable: true,
    },
  });
</script>
